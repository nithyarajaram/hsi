<h4>
  <%= link_to "Submit", new_post_path %>
  <%= link_to "Leaders", users_path %>
  <%= link_to "New", posts_path %>
  <%= link_to "Comments", comments_path %>
  <%= link_to "Threads" %> 
</h4>

<%  @posts.each do |post| %>
    
  <% if post.url.empty? %>

    <div>
      <img id="<%= "#{post.id}" %>" src="assets/arrow_17.gif" /></img>
      <%= link_to post.title, post_path(post) %>
    </div> 


  <% else %>
    
    <div>

      <img id="<%= "#{post.id}" %>" src="assets/arrow_17.gif" /></img>
      <%= link_to post.title, "#{post.url}" %>
         
    </div>
  
  <% end %>
  <% if !post.upvotes.empty? %>
    <div>
      <span class = "points" id = "<%= "#{post.id}"%>points"> 
        <%= pluralize(post.upvotes.count, "point") %> | </span>
       <em>posted <%=time_ago_in_words(post.created_at)%> ago | by <%= link_to post.user.username, user_path(post.user) %> |
         <% if post.comments.empty? %>
           <%=  link_to "discuss", post_path(post)%>
         <% else %>
           <%= link_to "#{post.comments.count} comments", post_path(post) %>
         <% end %>
         
         </em>
     </div>

  <% end %>
 
  <br/>
  <br/>



<% end %>

<script>
  $('img').click(function(e){
    e.preventDefault();
    $div = $(this).attr('id');
    $.ajax({
        context: this,
        type: "POST",
        beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
        url: "/upvotes",
        cache: false,
        data: {upvotable_id: $div, upvotable_type: "Post", url: "/"},
        success: function(json){
        $('span#'+ $div +'points').text(json + ' points |');
      }
    });
  });
</script>



